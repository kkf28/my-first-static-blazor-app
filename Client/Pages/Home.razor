@page "/"
@inject HttpClient Http

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<p>Validation Result: @Result</p>

@code {
    [SupplyParameterFromQuery]
    public string? signature { get; set; } // This property is used to receive a query parameter named "signature".
    [SupplyParameterFromQuery]
    public string? timestamp { get; set; } // This property is used to receive a query parameter named "timestamp".
    [SupplyParameterFromQuery]
    public string? nonce { get; set; } // This property is used to receive a query parameter named "nonce".
    [SupplyParameterFromQuery]
    public string? echostr { get; set; } // This property is used to receive a query parameter named "echostr".
    public string? Result { get; set; } // This property is used to store the result of the validation.
    // This method is called when the component is initialized.
    protected override async Task OnInitializedAsync()
    {
        // Check if the query parameters are not null or empty.
        if (!string.IsNullOrEmpty(signature) && !string.IsNullOrEmpty(timestamp) && !string.IsNullOrEmpty(nonce) && !string.IsNullOrEmpty(echostr))
        {
            // If they are not null or empty, display them in the console.
            Console.WriteLine($"signature: {signature}");
            Console.WriteLine($"timestamp: {timestamp}");
            Console.WriteLine($"nonce: {nonce}");
            Console.WriteLine($"echostr: {echostr}");
        }
         try
        {
           var response=  await Http.GetAsync("/api/WeChatValidation?signature=" + signature + "&timestamp=" + timestamp + "&nonce=" + nonce + "&echostr=" + echostr);
            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadAsStringAsync();
                Result = result; // Store the response content in the Result property.
                Console.WriteLine(result); // Log the response content to the console.
            }
            else
            {
                Console.WriteLine($"Error: {response.StatusCode}"); // Log the error status code to the console.
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.ToString());
        }
    }

}
